
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>galaxy.timecourse &#8212; ASTR400B Leach  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for galaxy.timecourse</h1><div class="highlight"><pre>
<span></span><span class="c1"># import modules</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>

<span class="kn">from</span> <span class="nn">galaxy.galaxy</span> <span class="kn">import</span> <span class="n">Galaxy</span>
<span class="kn">from</span> <span class="nn">galaxy.galaxies</span> <span class="kn">import</span> <span class="n">Galaxies</span>
<span class="kn">from</span> <span class="nn">galaxy.centerofmass</span> <span class="kn">import</span> <span class="n">CenterOfMass</span>
<span class="kn">from</span> <span class="nn">galaxy.db</span> <span class="kn">import</span> <span class="n">DB</span>

<div class="viewcode-block" id="TimeCourse"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse">[docs]</a><span class="k">class</span> <span class="nc">TimeCourse</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A commection of methods for generating, reading and writing summary data for </span>
<span class="sd">    parameters that change over the timecourse of the simulation.</span>

<span class="sd">    These fall into a few groups:</span>
<span class="sd">        `write_xxx()` : </span>
<span class="sd">            Methods that loop through the raw data, calculate parameters and write </span>
<span class="sd">            the results to file. Can be slow (hours) to run but Only run once. </span>
<span class="sd">            See the `data` folder for the resulting files, one line per snap.</span>

<span class="sd">        `read_xxx_file(`)` :</span>
<span class="sd">            Read in the summary files and return a numpy array. These rely on the</span>
<span class="sd">            generic `read_file()` method.</span>

<span class="sd">        `read_xxx_db()` :</span>
<span class="sd">            Get the summary data from postgres instead of a text file. </span>
<span class="sd">            The returned array should be identical to the `read_xxx_file()` group.</span>

<span class="sd">        `write_db_tables()` :</span>
<span class="sd">            Read a text file, insert the contents to a postgres table.</span>

<span class="sd">        `get_one_com()` :</span>
<span class="sd">            Convenience method to return a single CoM position.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">usesql</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="n">datadir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usesql</span> <span class="o">=</span> <span class="n">usesql</span>

<div class="viewcode-block" id="TimeCourse.write_com_ang_mom"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_com_ang_mom">[docs]</a>    <span class="k">def</span> <span class="nf">write_com_ang_mom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galname</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that loops over all the desired snapshots to compute the COM pos and vel as a </span>
<span class="sd">        function of time.</span>

<span class="sd">        inputs:</span>
<span class="sd">            galname (str):</span>
<span class="sd">                &#39;MW&#39;, &#39;M31&#39; or &#39;M33&#39;</span>
<span class="sd">            start, end (int):</span>
<span class="sd">                first and last snap numbers to include</span>
<span class="sd">            n (int):</span>
<span class="sd">                stride length for the sequence</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to the input data</span>
<span class="sd">            show_progress (bool):</span>
<span class="sd">                prints each snap number as it is processed</span>
<span class="sd">            </span>
<span class="sd">        returns: </span>
<span class="sd">            Two text files saved to disk. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># compose the filenames for output</span>
        <span class="n">com_fileout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./com_</span><span class="si">{galname}</span><span class="s1">.txt&#39;</span>
        <span class="n">angmom_fileout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./angmom_</span><span class="si">{galname}</span><span class="s1">.txt&#39;</span>
        
        <span class="c1">#  set tolerance and vol_dec for calculating COM_P in CenterOfMass</span>
        <span class="c1"># for M33 that is stripped more, use different values for vol_dec</span>
        <span class="k">if</span> <span class="n">galname</span> <span class="o">==</span> <span class="s1">&#39;M33&#39;</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="n">vol_dec</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">vol_dec</span> <span class="o">=</span> <span class="mi">2</span>
        
         <span class="c1"># generate the snapshot id sequence </span>
        <span class="n">snap_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># initialize the array for orbital info: t, x, y, z, vx, vy, vz of COM</span>
        <span class="n">orbit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">),</span> <span class="mi">7</span><span class="p">))</span>
        
        <span class="c1"># initialize the array for angular momentum info:</span>
        <span class="c1">#  t, (x, y, z)_hat, magnitude of L</span>
        <span class="n">angmom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">galname</span><span class="p">)</span>
        
        <span class="k">for</span>  <span class="n">i</span><span class="p">,</span> <span class="n">snap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">):</span> <span class="c1"># loop over files</span>
            <span class="n">gal</span> <span class="o">=</span> <span class="n">Galaxy</span><span class="p">(</span><span class="n">galname</span><span class="p">,</span> <span class="n">snap</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="n">usesql</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usesql</span><span class="p">)</span>
            
            <span class="c1"># Initialize an instance of CenterOfMass class, using disk particles</span>
            <span class="n">com</span> <span class="o">=</span> <span class="n">CenterOfMass</span><span class="p">(</span><span class="n">gal</span><span class="p">)</span>

            <span class="c1"># Store the COM pos and vel. Remember that now COM_P required VolDec</span>
            <span class="n">com_p</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">com_p</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">vol_dec</span><span class="p">)</span>
            <span class="n">com_v</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">com_v</span><span class="p">(</span><span class="n">com_p</span><span class="p">)</span>

            <span class="c1"># store the angular momentum as unit vector and magnitude</span>
            <span class="n">L</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">angular_momentum</span><span class="p">()</span>
            <span class="n">L_mag</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
            <span class="n">L_hat</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">L_mag</span>
        
            <span class="c1"># store the time, pos, vel in ith element of the orbit array, without units</span>
            <span class="n">orbit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gal</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">com_p</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">com_v</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            
           <span class="c1"># store the time, L_hat, L_mag in ith element of the angular momentum array</span>
            <span class="n">angmom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gal</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">L_hat</span><span class="p">),</span> <span class="n">L_mag</span>
            
            <span class="c1"># print snap_id to see the progress</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Done&#39;</span><span class="p">)</span>
            
        <span class="c1"># write the data to 2 files</span>
        <span class="c1"># we do this because we don&#39;t want to have to repeat this process </span>
        <span class="c1"># this code should only have to be called once per galaxy.</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">com_fileout</span><span class="p">,</span> <span class="n">orbit</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">7</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">))</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">angmom_fileout</span><span class="p">,</span> <span class="n">angmom</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%11.3e</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;x_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;y_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;z_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;L_mag&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TimeCourse.write_total_com"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_total_com">[docs]</a>    <span class="k">def</span> <span class="nf">write_total_com</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that loops over all the desired snapshots to compute the overall COM </span>
<span class="sd">        pos and vel as a function of time. Uses all particles in all galaxies.</span>

<span class="sd">        inputs:</span>
<span class="sd">            start, end (int):</span>
<span class="sd">                first and last snap numbers to include</span>
<span class="sd">            n (int):</span>
<span class="sd">                stride length for the sequence</span>
<span class="sd">            show_progress (bool):</span>
<span class="sd">                prints each snap number as it is processed</span>
<span class="sd">            </span>
<span class="sd">        output: </span>
<span class="sd">            Text file saved to disk. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fileout</span> <span class="o">=</span> <span class="s1">&#39;./total_com.txt&#39;</span>
        <span class="n">snap_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">),</span> <span class="mi">7</span><span class="p">))</span>

        <span class="k">for</span>  <span class="n">i</span><span class="p">,</span> <span class="n">snap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">):</span> <span class="c1"># loop over files</span>
            <span class="n">gals</span> <span class="o">=</span> <span class="n">Galaxies</span><span class="p">(</span><span class="n">snaps</span><span class="o">=</span><span class="p">[</span><span class="n">snap</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="n">usesql</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usesql</span><span class="p">)</span>
            <span class="n">full_com_p</span><span class="p">,</span> <span class="n">full_com_v</span> <span class="o">=</span> <span class="n">gals</span><span class="o">.</span><span class="n">total_com</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">gals</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span>
            <span class="n">coms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">full_com_p</span><span class="p">),</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">full_com_v</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Done&#39;</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">coms</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">7</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;vz&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TimeCourse.write_total_angmom"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_total_angmom">[docs]</a>    <span class="k">def</span> <span class="nf">write_total_angmom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that loops over all the desired snapshots to compute the overall </span>
<span class="sd">        angular momentum as a function of time. Uses all particles in all galaxies.</span>

<span class="sd">        inputs:</span>
<span class="sd">            start, end (int):</span>
<span class="sd">                first and last snap numbers to include</span>
<span class="sd">            n (int):</span>
<span class="sd">                stride length for the sequence</span>
<span class="sd">            show_progress (bool):</span>
<span class="sd">                prints each snap number as it is processed</span>
<span class="sd">            </span>
<span class="sd">        output: </span>
<span class="sd">            Text file saved to disk. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fileout</span> <span class="o">=</span> <span class="s1">&#39;./total_angmom.txt&#39;</span>
        <span class="n">snap_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">angmoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>

        <span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_total_com_db</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">])</span>
        <span class="c1"># print(com.shape, com[&#39;x&#39;].shape)</span>
        <span class="n">com_xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">com</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># print(com_xyz, com_xyz.shape)</span>

        <span class="k">for</span>  <span class="n">i</span><span class="p">,</span> <span class="n">snap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">):</span> <span class="c1"># loop over files</span>
            <span class="n">gals</span> <span class="o">=</span> <span class="n">Galaxies</span><span class="p">(</span><span class="n">snaps</span><span class="o">=</span><span class="p">[</span><span class="n">snap</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="n">usesql</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usesql</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">gals</span><span class="o">.</span><span class="n">total_angmom</span><span class="p">(</span><span class="n">com_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">gals</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span>
            <span class="n">angmoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Done&#39;</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">angmoms</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}{:&gt;11s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;Lx&#39;</span><span class="p">,</span> <span class="s1">&#39;Ly&#39;</span><span class="p">,</span> <span class="s1">&#39;Lz&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TimeCourse.write_vel_disp"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_vel_disp">[docs]</a>    <span class="k">def</span> <span class="nf">write_vel_disp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galname</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that loops over all the desired snapshots to compute the veocity dispersion</span>
<span class="sd">        sigma as a function of time.</span>

<span class="sd">        inputs:</span>
<span class="sd">            galname (str):</span>
<span class="sd">                &#39;MW&#39;, &#39;M31&#39; or &#39;M33&#39;</span>
<span class="sd">            start, end (int):</span>
<span class="sd">                first and last snap numbers to include</span>
<span class="sd">            n (int):</span>
<span class="sd">                stride length for the sequence</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to the input data</span>
<span class="sd">            show_progress (bool):</span>
<span class="sd">                prints each snap number as it is processed</span>
<span class="sd">            </span>
<span class="sd">        returns: </span>
<span class="sd">            Text file saved to disk. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># compose the filename for output</span>
        <span class="c1"># fileout = f&#39;./sigma_{galname}.txt&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./sigma_</span><span class="si">{galname}</span><span class="s1">_2.txt&#39;</span>

         <span class="c1"># generate the snapshot id sequence </span>
        <span class="n">snap_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># initialize the array for orbital info: t, sigma</span>
        <span class="n">sigmas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">galname</span><span class="p">)</span>
        
        <span class="k">for</span>  <span class="n">i</span><span class="p">,</span> <span class="n">snap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">snap_ids</span><span class="p">):</span> <span class="c1"># loop over files</span>
            <span class="n">gal</span> <span class="o">=</span> <span class="n">Galaxy</span><span class="p">(</span><span class="n">galname</span><span class="p">,</span> <span class="n">snap</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datadir</span><span class="p">,</span> <span class="n">usesql</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">usesql</span><span class="p">)</span>
            
            <span class="c1"># Initialize an instance of CenterOfMass class, using disk particles</span>
            <span class="n">com</span> <span class="o">=</span> <span class="n">CenterOfMass</span><span class="p">(</span><span class="n">gal</span><span class="p">)</span>

            <span class="c1"># COM pos and vel</span>
            <span class="n">com_xyz</span><span class="p">,</span> <span class="n">com_vxyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_one_com</span><span class="p">(</span><span class="n">galname</span><span class="p">,</span> <span class="n">snap</span><span class="p">)</span>  

            <span class="n">gal_xyzD</span><span class="p">,</span> <span class="n">gal_vxyzD</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">center_com</span><span class="p">(</span><span class="n">com_xyz</span><span class="p">,</span> <span class="n">com_vxyz</span><span class="p">)</span>

            <span class="c1"># determine the rotated velocity vectors</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">vn</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="n">rotate_frame</span><span class="p">(</span><span class="n">com_p</span><span class="o">=</span><span class="n">com_xyz</span><span class="p">,</span> <span class="n">com_v</span><span class="o">=</span><span class="n">com_vxyz</span><span class="p">)</span>
            
            <span class="c1"># calculate velocity dispersion</span>
            <span class="n">v_radial</span> <span class="o">=</span> <span class="n">vn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># just x-component</span>
            <span class="n">v_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_radial</span><span class="p">)</span>
            <span class="n">sigmas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gal</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v_radial</span> <span class="o">-</span> <span class="n">v_mean</span><span class="p">)</span>

            <span class="c1"># print snap_id to see the progress</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">snap</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Done&#39;</span><span class="p">)</span>
            
        <span class="c1"># write the data to file</span>
        <span class="c1"># we do this because we don&#39;t want to have to repeat this process </span>
        <span class="c1"># this code should only have to be called once per galaxy.</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TimeCourse.write_LG_normal"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_LG_normal">[docs]</a>    <span class="k">def</span> <span class="nf">write_LG_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the normal to a plane containing the three galaxy CoMs.</span>

<span class="sd">        Args:</span>
<span class="sd">            start, end (int):</span>
<span class="sd">                first and last snap numbers to include</span>
<span class="sd">            </span>
<span class="sd">        output: </span>
<span class="sd">            Text file saved to disk. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get all the CoM info from postgres</span>
        <span class="n">MW_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">)</span>
        <span class="n">M31_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;M31&#39;</span><span class="p">)</span>
        <span class="n">M33_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;M33&#39;</span><span class="p">)</span>
        
        <span class="c1"># pull out just the 3 columns giving position</span>
        <span class="n">MW_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MW_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>
        <span class="n">M31_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M31_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>
        <span class="n">M33_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M33_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>

        <span class="c1"># define 2 vectors that lie in the plane</span>
        <span class="n">M31_MW</span> <span class="o">=</span> <span class="n">MW_coms</span> <span class="o">-</span> <span class="n">M31_coms</span>
        <span class="n">M31_M33</span> <span class="o">=</span> <span class="n">M33_coms</span> <span class="o">-</span> <span class="n">M31_coms</span>

        <span class="c1"># the normal we want comes from the vector cross product</span>
        <span class="n">normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">M31_MW</span><span class="p">,</span> <span class="n">M31_M33</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">normals</span> <span class="o">/=</span> <span class="n">norm</span><span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">MW_data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">normals</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            
        <span class="c1"># compose the filename for output</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="s1">&#39;./normals.txt&#39;</span>

        <span class="c1"># write the data to file</span>
        <span class="c1"># we do this because we don&#39;t want to have to repeat this process </span>
        <span class="c1"># this code should only have to be called once</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%11.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;10s}{:&gt;11s}{:&gt;11s}{:&gt;11s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;x_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;y_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;z_hat&#39;</span><span class="p">))</span></div>
              
<div class="viewcode-block" id="TimeCourse.write_rel_motion"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_rel_motion">[docs]</a>    <span class="k">def</span> <span class="nf">write_rel_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">801</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get all the CoM info from postgres</span>
        <span class="n">MW_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">)</span>
        <span class="n">M31_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;M31&#39;</span><span class="p">)</span>
        <span class="n">M33_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="s1">&#39;M33&#39;</span><span class="p">)</span>
        
        <span class="c1"># pull out the 3 columns giving position</span>
        <span class="n">pos_MW_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MW_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>
        <span class="n">pos_M31_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M31_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>
        <span class="n">pos_M33_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M33_data</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>

        <span class="c1"># pull out the 3 columns giving velocity</span>
        <span class="n">vel_MW_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MW_data</span><span class="p">[</span><span class="n">vxi</span><span class="p">]</span> <span class="k">for</span> <span class="n">vxi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">)])</span>
        <span class="n">vel_M31_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M31_data</span><span class="p">[</span><span class="n">vxi</span><span class="p">]</span> <span class="k">for</span> <span class="n">vxi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">)])</span>
        <span class="n">vel_M33_coms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M33_data</span><span class="p">[</span><span class="n">vxi</span><span class="p">]</span> <span class="k">for</span> <span class="n">vxi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">)])</span>

        <span class="c1"># define relative distances</span>
        <span class="n">pos_MW_M31</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">pos_MW_coms</span> <span class="o">-</span> <span class="n">pos_M31_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pos_M33_M31</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">pos_M33_coms</span> <span class="o">-</span> <span class="n">pos_M31_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pos_M33_MW</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">pos_M33_coms</span> <span class="o">-</span> <span class="n">pos_MW_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># define relative speeds</span>
        <span class="n">vel_MW_M31</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">vel_MW_coms</span> <span class="o">-</span> <span class="n">vel_M31_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vel_M33_M31</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">vel_M33_coms</span> <span class="o">-</span> <span class="n">vel_M31_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vel_M33_MW</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">vel_M33_coms</span> <span class="o">-</span> <span class="n">vel_MW_coms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">output_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">MW_data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> 
                        <span class="n">pos_MW_M31</span><span class="p">,</span> <span class="n">pos_M33_M31</span><span class="p">,</span> <span class="n">pos_M33_MW</span><span class="p">,</span>
                        <span class="n">vel_MW_M31</span><span class="p">,</span> <span class="n">vel_M33_M31</span><span class="p">,</span> <span class="n">vel_M33_MW</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">output_cols</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            
        <span class="c1"># compose the filename for output</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="s1">&#39;./relmotion.txt&#39;</span>

        <span class="c1"># write the data to file</span>
        <span class="c1"># we do this because we don&#39;t want to have to repeat this process </span>
        <span class="c1"># this code should only have to be called once</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%13.3f</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">7</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:&gt;12s}{:&gt;13s}{:&gt;13s}{:&gt;13s}{:&gt;13s}{:&gt;13s}{:&gt;13s}</span><span class="s2">&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;pos_MW_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;pos_M33_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;pos_M33_MW&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;vel_MW_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;vel_M33_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;vels_M33_MW&#39;</span><span class="p">))</span></div>
  

<div class="viewcode-block" id="TimeCourse.read_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General method for file input. Note that the format is for summary files,</span>
<span class="sd">        (one line per snap), not the raw per-particle files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_header</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>
 

<div class="viewcode-block" id="TimeCourse.read_com_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_com_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_com_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get CoM summary from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            galaxy (str): </span>
<span class="sd">                &#39;MW&#39;, &#39;M31&#39;, &#39;M33&#39;</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to file</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array with 802 rows, one per snap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;com_</span><span class="si">{galaxy}</span><span class="s1">.txt&#39;</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TimeCourse.read_angmom_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_angmom_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_angmom_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get CoM summary from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            galaxy (str): </span>
<span class="sd">                &#39;MW&#39;, &#39;M31&#39;, &#39;M33&#39;</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to file</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array with 802 rows, one per snap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;angmom_</span><span class="si">{galaxy}</span><span class="s1">.txt&#39;</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TimeCourse.read_total_com_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_total_com_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_total_com_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get CoM summary from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to file</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array with 802 rows, one per snap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;total_com.txt&#39;</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TimeCourse.read_normals_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_normals_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_normals_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get normals to plane containing 3 galaxy CoMs from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to file</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array with 802 rows, one per snap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;normals.txt&#39;</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_relmotion_file"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_relmotion_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_relmotion_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get relative CoM distances/velocities from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            datadir (str):</span>
<span class="sd">                path to file</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.array with 802 rows, one per snap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;relmotion.txt&#39;</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.write_db_tables"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.write_db_tables">[docs]</a>    <span class="k">def</span> <span class="nf">write_db_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">do_com</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_angmom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">do_totalcom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_totalangmom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_normals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">do_sigmas</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_relmotion</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds data to the various tables in the `galaxy` database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datadir</span><span class="p">)</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_cursor</span><span class="p">()</span>

        <span class="c1"># CoM data</span>
        <span class="k">if</span> <span class="n">do_com</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO centerofmass( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span><span class="s1">&#39;M31&#39;</span><span class="p">,</span><span class="s1">&#39;M33&#39;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;com_</span><span class="si">{gname}</span><span class="s1">.txt&#39;</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">gname</span><span class="p">,</span> <span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># angular momentum data</span>
        <span class="k">if</span> <span class="n">do_angmom</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span><span class="s1">&#39;z_hat&#39;</span><span class="p">,</span><span class="s1">&#39;l_mag&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO angmom( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span><span class="s1">&#39;M31&#39;</span><span class="p">,</span><span class="s1">&#39;M33&#39;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;angmom_</span><span class="si">{gname}</span><span class="s1">.txt&#39;</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                    
                <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">gname</span><span class="p">,</span> <span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># total CoM data</span>
        <span class="k">if</span> <span class="n">do_totalcom</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO totalcom( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;total_com.txt&#39;</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># total angular momentum data</span>
        <span class="k">if</span> <span class="n">do_totalangmom</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;Lx&#39;</span><span class="p">,</span><span class="s1">&#39;Ly&#39;</span><span class="p">,</span><span class="s1">&#39;Lz&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO totalangmom( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;total_angmom.txt&#39;</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># 3-galaxy normals data</span>
        <span class="k">if</span> <span class="n">do_normals</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span><span class="s1">&#39;z_hat&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO normals( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;normals.txt&#39;</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># velocity dispersions</span>
        <span class="k">if</span> <span class="n">do_sigmas</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO sigmas( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="k">for</span> <span class="n">gname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span><span class="s1">&#39;M31&#39;</span><span class="p">,</span><span class="s1">&#39;M33&#39;</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;sigma_</span><span class="si">{gname}</span><span class="s1">.txt&#39;</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                    
                <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">gname</span><span class="p">,</span> <span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>

        <span class="c1"># relative motions</span>
        <span class="k">if</span> <span class="n">do_relmotion</span><span class="p">:</span>
            <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;pos_MW_M31&#39;</span><span class="p">,</span><span class="s1">&#39;pos_M33_M31&#39;</span><span class="p">,</span><span class="s1">&#39;pos_M33_MW&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;vel_MW_M31&#39;</span><span class="p">,</span><span class="s1">&#39;vel_M33_M31&#39;</span><span class="p">,</span><span class="s1">&#39;vel_M33_MW&#39;</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                INSERT INTO relmotion( </span><span class="si">{colheads}</span><span class="s2"> ) </span>
<span class="s2">                VALUES (</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                ON CONFLICT DO NOTHING</span>
<span class="s2">                &quot;&quot;&quot;</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;relmotion.txt&#39;</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">snap</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="p">[</span><span class="n">snap</span><span class="p">,]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_com_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_com_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_com_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves CoM positions from postgres for a range of snaps.</span>

<span class="sd">        Args:</span>
<span class="sd">            galaxy (str):</span>
<span class="sd">                Optional, defaults to all. Can be &#39;MW&#39;, &#39;M31&#39; , &#39;M33&#39;</span>
<span class="sd">            snaprange (pair of ints):</span>
<span class="sd">                Optional, defaults to all. First and last snap to include.</span>
<span class="sd">                This is NOT the [first, last+1] convention of Python.</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM centerofmass </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">galaxy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY snap&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; AND gal=&#39;</span><span class="si">{galaxy}</span><span class="s2">&#39; ORDER BY gal, snap&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span> <span class="s1">&#39;U3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vz&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TimeCourse.read_angmom_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_angmom_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_angmom_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves disk angular momentum from postgres for a range of snaps.</span>

<span class="sd">        Args:</span>
<span class="sd">            galaxy (str):</span>
<span class="sd">                Optional, defaults to all. Can be &#39;MW, &#39;M31 , &#39;M33&#39;</span>
<span class="sd">            snaprange (pair of ints):</span>
<span class="sd">                Optional, defaults to all. First and last snap to include.</span>
<span class="sd">                This is NOT the [first, last+1] convention of Python.</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span><span class="s1">&#39;z_hat&#39;</span><span class="p">,</span><span class="s1">&#39;l_mag&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM angmom </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">               &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">galaxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; AND gal=&#39;</span><span class="si">{galaxy}</span><span class="s2">&#39;&quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY snap&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span> <span class="s1">&#39;U3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;z_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;l_mag&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_total_com_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_total_com_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_total_com_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves total CoM positions from postgres for a range of snaps.</span>

<span class="sd">        Args:</span>
<span class="sd">            snaprange (pair of ints):</span>
<span class="sd">                Optional, defaults to all. First and last snap to include.</span>
<span class="sd">                This is NOT the [first, last+1] convention of Python.</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM totalcom </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                ORDER BY snap</span>
<span class="s2">                &quot;&quot;&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vz&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.get_one_com"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.get_one_com">[docs]</a>    <span class="k">def</span> <span class="nf">get_one_com</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gal</span><span class="p">,</span> <span class="n">snap</span><span class="p">)</span>       <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a CoM from postgres for the specified galaxy and snap.</span>

<span class="sd">        Args:</span>
<span class="sd">            gal (str): </span>
<span class="sd">                Can be &#39;MW, &#39;M31 , &#39;M33&#39;</span>
<span class="sd">            snap (int):</span>
<span class="sd">                The timepoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">com</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_com_db</span><span class="p">(</span><span class="n">gal</span><span class="p">,</span> <span class="p">(</span><span class="n">snap</span><span class="p">,</span><span class="n">snap</span><span class="p">))</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">com</span><span class="p">[</span><span class="n">xi</span><span class="p">]</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])</span>
        <span class="n">vxyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">com</span><span class="p">[</span><span class="n">vxi</span><span class="p">]</span> <span class="k">for</span> <span class="n">vxi</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">)])</span>

        <span class="c1"># need to massage the shapes a bit to match what c.com_p() returns</span>
        <span class="k">return</span> <span class="n">xyz</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vxyz</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="TimeCourse.read_total_angmom_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_total_angmom_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_total_angmom_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the total angular momentum of the 3-galaxy system. In practice, </span>
<span class="sd">        this turns out to be near-zero at all timepoints and can be ignored</span>
<span class="sd">        in future work.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;Lx&#39;</span><span class="p">,</span><span class="s1">&#39;Ly&#39;</span><span class="p">,</span><span class="s1">&#39;Lz&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM totalangmom </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                ORDER BY snap</span>
<span class="s2">               &quot;&quot;&quot;</span>
 
        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Lx&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Ly&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;Lz&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_normals_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_normals_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_normals_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the normals to the 3-galaxy plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span><span class="s1">&#39;z_hat&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM normals </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                ORDER BY snap</span>
<span class="s2">               &quot;&quot;&quot;</span>
 
        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;x_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;z_hat&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_sigmas_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_sigmas_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_sigmas_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">galaxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the velocity dispersions (km/s) for one galaxy at a range of snaps.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM sigmas </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">galaxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; AND gal=&#39;</span><span class="si">{galaxy}</span><span class="s2">&#39;&quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY snap&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;gal&#39;</span><span class="p">,</span> <span class="s1">&#39;U3&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeCourse.read_relmotion_db"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.read_relmotion_db">[docs]</a>    <span class="k">def</span> <span class="nf">read_relmotion_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snaprange</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">801</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves relative CoM positions and velocities from postgres </span>
<span class="sd">        for a range of snaps.</span>

<span class="sd">        Args:</span>
<span class="sd">            snaprange (pair of ints):</span>
<span class="sd">                Optional, defaults to all. First and last snap to include.</span>
<span class="sd">                This is NOT the [first, last+1] convention of Python.</span>
<span class="sd">       &quot;&quot;&quot;</span>

        <span class="n">colheads</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;pos_MW_M31&#39;</span><span class="p">,</span><span class="s1">&#39;pos_M33_M31&#39;</span><span class="p">,</span><span class="s1">&#39;pos_M33_MW&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;vel_MW_M31&#39;</span><span class="p">,</span><span class="s1">&#39;vel_M33_M31&#39;</span><span class="p">,</span><span class="s1">&#39;vel_M33_MW&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT </span><span class="si">{colheads}</span><span class="s2"> FROM relmotion </span>
<span class="s2">                WHERE snap BETWEEN </span><span class="si">{snaprange[0]}</span><span class="s2"> AND </span><span class="si">{snaprange[1]}</span><span class="s2"></span>
<span class="s2">                ORDER BY snap</span>
<span class="s2">                &quot;&quot;&quot;</span>

        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;pos_MW_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;pos_M33_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;pos_M33_MW&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> 
                <span class="p">(</span><span class="s1">&#39;vel_MW_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vel_M33_M31&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;vel_M33_MW&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f4&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TimeCourse.snap2time"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.snap2time">[docs]</a>    <span class="k">def</span> <span class="nf">snap2time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT t from relmotion WHERE snap=</span><span class="si">{snap}</span><span class="s2">&quot;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="TimeCourse.time2snap"><a class="viewcode-back" href="../../timecourse.html#galaxy.timecourse.TimeCourse.time2snap">[docs]</a>    <span class="k">def</span> <span class="nf">time2snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arg:</span>
<span class="sd">            time (float): value in Gyr</span>
<span class="sd">        Returns:</span>
<span class="sd">            List of closest values, often but not reliably just one.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        SELECT snap, t from relmotion </span>
<span class="s2">        WHERE t BETWEEN </span><span class="si">{time}</span><span class="s2">-0.005 AND </span><span class="si">{time}</span><span class="s2">+0.005&quot;&quot;&quot;</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">DB</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>
             
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ASTR400B Leach</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../galaxy.html">Galaxy class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../galaxies.html">Galaxies class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../centerofmass.html">CenterOfMass class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../massprofile.html">MassProfile class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timecourse.html">TimeCourse class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities.html">utilities module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db.html">DB class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remnant.html">Remnant class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../approaches.html">Approaches class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../surfacedensity.html">SurfaceDensityProfile class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../remvdisp.html">Vdisp class</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Colin Leach.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>